<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no">
    <title>ArcGIS JavaScript Tutorials: Create a Starter App</title>
    <style>
        html,
        body,
        #viewDiv {
            padding: 0;
            margin: 0;
            height: 100%;
            width: 100%;
        }
    </style>

    <link rel="stylesheet" href="https://js.arcgis.com/4.15/esri/themes/light/main.css">
    <script src="https://js.arcgis.com/4.15/"></script>

    <script>
        var list_points = [];
        var string_points = "";
        var myCoordinates = [];
        fetch("data.txt")
            .then((res) => res.text())
            .then((text) => {
                var lines = text.split('\n');
                lines.forEach(function (line) {
                    var values = line.split(',');

                    myCoordinates.push([parseFloat(values[1]), parseFloat(values[0])]);

                });
                myCoordinates.splice(-1)
            })
            .catch((e) => console.error(e));
        function copyTextToClipboard(text) {
            if (!navigator.clipboard) {
                fallbackCopyTextToClipboard(text);
                return;
            }
            navigator.clipboard.writeText(text).then(function () {
                console.log('Async: Copying to clipboard was successful!');
            }, function (err) {
                console.error('Async: Could not copy text: ', err);
            });
        }


        var point_template_school = {
            title: "{Name}",
            content: `  <p>Địa chỉ: {Location}</p>`
        };
        var point_template_area = {
            title: "{Name}",
            content: "Khu vực này ở <b>{Location}</b> với diện tích là <b>{Square}</b>.\n Hiện đang có <b>{Population}</b> sinh sống"
        };

        var jsondata = {
            "points": [
                {


                    type: "point",
                    longitude: 106.412005,
                    latitude: 11.228524,
                    Name: "Trường Tiểu học Thanh Tân",
                    Location: "Dầu Tiếng, Bình Dương, Vietnam",
                    symbol: {
                        type: "picture-marker",
                        url: "http://static.arcgis.com/images/Symbols/PeoplePlaces/School.png",
                        width: "20px",
                        height: "20px"
                    },
                    popupTemplate: point_template_school
                }, {


                    type: "point",
                    longitude: 106.51384790233195,
                    latitude: 11.427301867835798, 
                    Name: "Trường Tiểu học Thanh An",
                    Location: "Dầu Tiếng, Bình Dương, Vietnam",
                    symbol: {
                        type: "picture-marker",
                        url: "http://static.arcgis.com/images/Symbols/PeoplePlaces/School.png",
                        width: "20px",
                        height: "20px"
                    },
                    popupTemplate: point_template_school
                },
                {
                    type: "point",
                    longitude: 106.489086,
                    latitude: 11.315869,
                    Name: "Trường Tiểu học Long Hoà",
                    Location: "Dầu Tiếng, Bình Dương, Vietnam",
                    symbol: {
                        type: "picture-marker",
                        url: "http://static.arcgis.com/images/Symbols/PeoplePlaces/School.png",
                        width: "20px",
                        height: "20px"
                    },
                    popupTemplate: point_template_school
                },
                {
                    type: "point",
                    longitude: 106.362014,
                    latitude: 11.269928,
                    Name: "Trường Tiểu học Ngô Quyền",
                    Location: "Dầu Tiếng, Bình Dương, Vietnam",
                    symbol: {
                        type: "picture-marker",
                        url: "http://static.arcgis.com/images/Symbols/PeoplePlaces/School.png",
                        width: "20px",
                        height: "20px"
                    },
                    popupTemplate: point_template_school
                },
                {
                    type: "point",
                    longitude: 106.39157294549402,
                    latitude: 11.286595874746281,
                    Name: "THCS Nguyễn Bỉnh Khiêm",
                    Location: "Dầu Tiếng, Bình Dương, Vietnam",
                    symbol: {
                        type: "picture-marker",
                        url: "http://static.arcgis.com/images/Symbols/PeoplePlaces/School.png",
                        width: "20px",
                        height: "20px"
                    },
                    popupTemplate: point_template_school
                },
                {
                    type: "point",
                    longitude: 106.47615108841306,
                    latitude: 11.227818345829892,
                    Name: "Trường Trung Học Cơ Sở An Lập",
                    Location: "Dầu Tiếng, Bình Dương, Vietnam",
                    symbol: {
                        type: "picture-marker",
                        url: "http://static.arcgis.com/images/Symbols/PeoplePlaces/School.png",
                        width: "20px",
                        height: "20px"
                    },
                    popupTemplate: point_template_school
                },
                {
                    type: "point",
                    longitude: 106.47955432558398,
                    latitude: 11.325511981849067,
                    Name: "Trường Trung Học Cơ Sở Long Hoà",
                    Location: "Dầu Tiếng, Bình Dương, Vietnam",
                    symbol: {
                        type: "picture-marker",
                        url: "http://static.arcgis.com/images/Symbols/PeoplePlaces/School.png",
                        width: "20px",
                        height: "20px"
                    },
                    popupTemplate: point_template_school
                },
                {
                    type: "point",
                    longitude: 106.4493170810887,
                    latitude: 11.406475810500352,
                    Name: "Trường THCS Minh Tân",
                    Location: "Dầu Tiếng, Bình Dương, Vietnam",
                    symbol: {
                        type: "picture-marker",
                        url: "http://static.arcgis.com/images/Symbols/PeoplePlaces/School.png",
                        width: "20px",
                        height: "20px"
                    },
                    popupTemplate: point_template_school
                },
                {
                    type: "point",
                    longitude: 106.47860846944286,
                    latitude: 11.439919039818063,
                    Name: "Trường THPT Phan Bội Châu",
                    Location: "Dầu Tiếng, Bình Dương, Vietnam",
                    symbol: {
                        type: "picture-marker",
                        url: "http://static.arcgis.com/images/Symbols/PeoplePlaces/School.png",
                        width: "20px",
                        height: "20px"
                    },
                    popupTemplate: point_template_school
                },
                {
                    type: "point",
                    longitude: 106.36722553080689,
                    latitude: 11.281741791697334,
                    Name: "Trường THPT Dầu Tiếng",
                    Location: "Dầu Tiếng, Bình Dương, Vietnam",
                    symbol: {
                        type: "picture-marker",
                        url: "http://static.arcgis.com/images/Symbols/PeoplePlaces/School.png",
                        width: "20px",
                        height: "20px"
                    },
                    popupTemplate: point_template_school
                },
                {
                    type: "point",
                    longitude: 106.44413879796073,
                    latitude: 11.176174310372422,
                    Name: "Trường THPT Thanh Tuyền",
                    Location: "Dầu Tiếng, Bình Dương, Vietnam",
                    symbol: {
                        type: "picture-marker",
                        url: "http://static.arcgis.com/images/Symbols/PeoplePlaces/School.png",
                        width: "20px",
                        height: "20px"
                    },
                    popupTemplate: point_template_school
                },

                {
                    type: "point",
                    longitude: 106.47848567003008,
                    latitude: 11.440763666510083,
                    Name: "Trường THCS Minh Hòa",
                    Location: "Dầu Tiếng, Bình Dương, Vietnam",
                    symbol: {
                        type: "picture-marker",
                        url: "http://static.arcgis.com/images/Symbols/PeoplePlaces/School.png",
                        width: "20px",
                        height: "20px"
                    },
                    popupTemplate: point_template_school
                },
            ],

            "polygons": [
                {
                    type: "polygon",
                    Population: "22.403 người",
                    Square: "721,95 km²",
                    rings: myCoordinates,
                    Name: "Dầu Tiếng",
                    Location: "phía tây bắc tỉnh Bình Dương",
                    symbol: {
                        type: "simple-fill",
                        color: [204, 153, 0, 0.4],
                        outline: {
                            color: [135, 206, 250],
                            width: 1
                        }
                    },
                    popupTemplate: point_template_area

                },

            ]

        };
        require([
            "esri/Map",
            "esri/views/MapView",
            "esri/Graphic",
            "esri/layers/GraphicsLayer"
        ], function (Map, MapView, Graphic, GraphicsLayer) {

            var map = new Map({
                basemap: "topo-vector"
            });
            map.on("load", function () {
                map.graphics.enableMouseEvents();
            });

            var view = new MapView({
                container: "viewDiv",
                map: map,
                center: [106.4632913641617, 11.418561717102616],
                zoom: 15,
                highlightOptions: {
                    color: "blue"
                }
            });
            var createGraphic = function (data) {
                return new Graphic({
                    geometry: data,
                    symbol: data.symbol,
                    attributes: data,
                    popupTemplate: data.popupTemplate
                });
            };

            // view.popup.autoOpenEnabled = false; // Disable the default popup behavior
            // view.on("click", function (event) { // Listen for the click event
            //     view.hitTest(event).then(function (hitTestResults) { // Search for features where the user clicked
            //         if (hitTestResults.results) {
            //             list_points.push([event.mapPoint.longitude, event.mapPoint.latitude]);
            //             string_points += "[" + event.mapPoint.longitude + ", " + event.mapPoint.latitude + "],"
            //             copyTextToClipboard(string_points);
            //             console.log(list_points);
            //         }
            //     })
            // });

            var graphicsLayer = new GraphicsLayer();

            jsondata.points.forEach(function (data) {
                graphicsLayer.add(createGraphic(data));
            });
            jsondata.polygons.forEach(function (data) {
                graphicsLayer.add(createGraphic(data));
            });
            map.add(graphicsLayer);

        });
    </script>
</head>

<body>
    <div id="viewDiv"></div>
</body>

</html>