<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no">
    <title>ArcGIS JavaScript Tutorials: Create a Starter App</title>
    <style>
        html,
        body,
        #viewDiv {
            padding: 0;
            margin: 0;
            height: 100%;
            width: 100%;
        }
    </style>

    <link rel="stylesheet" href="https://js.arcgis.com/4.15/esri/themes/light/main.css">
    <script src="https://js.arcgis.com/4.15/"></script>

    <script>
        var list_points = [];
        var string_points = "";
        var myCoordinates = [];
        fetch("data.txt")
            .then((res) => res.text())
            .then((text) => {
                var lines = text.split(';');
                console.log(lines)
                lines.forEach(function (line) {
                    var values = line.split(',');

                    myCoordinates.push([parseFloat(values[0]), parseFloat(values[1])]);
                    
                });
                myCoordinates.splice(-1)
            })
            .catch((e) => console.error(e));
        function copyTextToClipboard(text) {
            if (!navigator.clipboard) {
                fallbackCopyTextToClipboard(text);
                return;
            }
            navigator.clipboard.writeText(text).then(function () {
                console.log('Async: Copying to clipboard was successful!');
            }, function (err) {
                console.error('Async: Could not copy text: ', err);
            });
        }
        var point_template_tree = {
            title: "{Name}",
            content: "Cây này ở <b>{Location}</b>."
        };
        var point_template_light = {
            title: "{Name}",
            content: "Bóng đèn này ở <b>{Location}</b>."
        };
        var point_template_chair = {
            title: "{Name}",
            content: "Cái ghế này ở <b>{Location}</b>."
        };
        var point_template_area = {
            title: "{Name}",
            content: "Khu vực này ở <b>{Location}</b>."
        };
        var point_template_university = {
            title: "{Name}",
            content: "Trường ở <b>{Location}</b>."
        };
        var jsondata = {

            "lines": [

                {
                    type: "polyline",
                    paths: myCoordinates,
                    symbol: {
                        type: "simple-line",
                        color: [204, 0, 204], // pink
                        width: 2
                    },
                    Name: "Dầu Tiếng",
                    Location: "Thành phố",
                    popupTemplate: point_template_area
                }
            ],

        };
        require([
            "esri/Map",
            "esri/views/MapView",
            "esri/Graphic",
            "esri/layers/GraphicsLayer"
        ], function (Map, MapView, Graphic, GraphicsLayer) {

            var map = new Map({
                basemap: "topo-vector"
            });
            map.on("load", function () {
                map.graphics.enableMouseEvents();
            });

            var view = new MapView({
                container: "viewDiv",
                map: map,
                center: [106.4632913641617, 11.418561717102616],
                zoom: 15,
                highlightOptions: {
                    color: "blue"
                }
            });
            var createGraphic = function (data) {
                return new Graphic({
                    geometry: data,
                    symbol: data.symbol,
                    attributes: data,
                    popupTemplate: data.popupTemplate
                });
            };

            view.popup.autoOpenEnabled = false; // Disable the default popup behavior
            view.on("click", function (event) { // Listen for the click event
                view.hitTest(event).then(function (hitTestResults) { // Search for features where the user clicked
                    if (hitTestResults.results) {
                        list_points.push([event.mapPoint.longitude, event.mapPoint.latitude]);
                        string_points += "[" + event.mapPoint.longitude + ", " + event.mapPoint.latitude + "],"
                        copyTextToClipboard(string_points);
                        console.log(list_points);
                    }
                })
            });

            var graphicsLayer = new GraphicsLayer();

            jsondata.lines.forEach(function (data) {
                graphicsLayer.add(createGraphic(data));
            });

            map.add(graphicsLayer);


        });
    </script>
</head>

<body>
    <div id="viewDiv"></div>
</body>

</html>